---
tags: [obsidian,документация,github,заметки,базазнаний]
---
# Использование GitHub для работы с заметками

Я использую GitHub для управления версиями своих записей - чтобы детектить случайно сделанные изменения и откатывать их. В большинстве случаев этот процесс не нужен, но в тех самых редких случаях - приятно, когда он есть.

Поначалу это казалось немного перебором, но в последнее время я довольно активно контактирую с гитхабом, так что сейчас этот подход очень легко вписался в мою ежедневную рутину.

## Как просто сделать первичную настройку GitHub репозитория

1. Создать учетную записи на [GitHub](https://github.com/)
2. После активации учетной записи создать репозиторий при помощи `Your repositories` -> `New` и указать, что репозиторий приватный (если не предполагается, что к этим заметкам будут иметь доступ все)
3. Установить [GitHub Desktop](https://desktop.github.com/) на компьютер (если комп на линуксе, то можно взять неофициальный клиент [отсюда](https://github.com/shiftkey/desktop))
4. Далее - зайти в репозиторий и выбрать создание клона репозитория с помощью `Code` -> `Open with GitHub Desktop`
5. В открывшемся окне указать местоположение папки, в которую будет склонирован репозиторий хранилища заметок Obsidian. Только тут есть момент, что GitHub Desktop будет требовать пустую папку для создания клона, и придется либо смириться и оставить старую папку хранилища как бэкап, либо на время вырезать из нее все файлы (не забыв при этом про скрытые)
6. После клонирования репозитория скопировать в папку все файлы и папки, включая скрытые, и открыть эту папку как хранилище в Obsidian (если это новая папка, то Obsidian сначала спросит, можно ли в этом зхранилище использовать сторонние плагины, и после утвердительного ответа нужно будет включить сторонние плагины через настройки)

GitHub - не файлообменник, даже если оплатить более высокий уровень учетной записи. Размер загружаемого файла ограничен 100 Мб (при загрузке файла через браузер - 25 Мб), так что имеет смысл копировать туда только текстовые файлы и изображения. Явного лимита на размер хранилища нет, но вот что GitHub пишут в мануалах:

> We recommend repositories remain small, ideally less than 1 GB, and less than 5 GB is strongly recommended. Smaller repositories are faster to clone and easier to work with and maintain. Individual files in a repository are strictly limited to a 100 MB maximum size limit.

Настройка, на что не нужно обращать внимание при синхронизации, выполняется путем создания в корне репозитория файла `.gitignore`: все, что в него включено, будет игнорироваться клиентом, указывать можно как конкретные файлы, так и папки и расширения файлов. Пример того, что включено в `.gitignore` у меня - в заметках ниже.

7. Теперь, когда гитхаб клиент знает, версионность чего нужно вести, а файлы хранилища скопированы в локальный репозиторий - можно указать в поле Summary, что это первичная версия файлов (или просто дату - это поле используется для маркировки изменений), нажать Commit to master (master здесь - название ветки файлов в репозитории, по умолчанию там может быть имя main), после чего нажать кнопку `Push origin`

Настройка репозитория на этом заканчивается, можно приступать к работе.

## Непосредственно работа

Когда в хранилище происходят изменения файлов, GitHub Desktop подсвечивает их и дает выбрать, что с ними нужно сделать:

- если измененный файл не нужно синхронизировать, можно правым кликом по нему добавить его в .gitignore или просто отжать чекбокс
- если изменение файла нужно откатить целиком, то по правому клику нужно выбрать Discard changes
- если в файле нужно отменить удаление конкретной строки, то нужно в показанных справа изменениях правым кликом по нужной строке выбрать Discard removed lines:

![GitHub Desktop discard removed line.png](https://publish-01.obsidian.md/access/453568c251804cba377341907a93da32/%2BResources/img/GitHub%20Desktop%20discard%20removed%20line.png)

- если же в файле лишний добавленный текст - то у нужной строки можно убрать выделение (тогда чекбокс около имени файла изменит свой вид на частично заполненный):

![GitHub Desktop line changes.png](https://publish-01.obsidian.md/access/453568c251804cba377341907a93da32/%2BResources/img/GitHub%20Desktop%20line%20changes.png)

- если нужно откатить изменения только в части строки (это крайне редкий случай, конечно) - то нужно уже открывать файл отдельно. Я в таких случаях открываю файл не в Obsidian, а в [Atom](https://atom.io/) (через правый клик по названию файла в GitHub Desktop) - в нем будет подсветка измененных строк (удаленные строки не показывает, правда, хотя скорее всего это можно настроить)

Когда вся работа с отсмотром и принятием решений по изменениям выполнена - пора заполнить название (и если хочется - еще и описание) изменения и сделать волевое нажатие на Commit to master.

И тут возможно два сценария:

- наиболее частый: клиент при сравнении локальных изменений с версией на сервере не видит никаких противоречий и дает сделать Push изменений на сервер
- вариант, который может встретиться, если на сервере была более новая версия файла, чем изменяемая с компа: появится сообщение о конфликте версий, который будет предложено разрешить (можно просто выбрать, локальную или серверную версию файла использовать, а можно открыть тот же Atom и сравнить все изменения детальнее)

Побуду капитаном и скажу, что второй сценарий обычно возникает при работе с репозиторием с нескольких устройств. Чтобы он возникал реже, есть два способа:

- актуальный, если гит - не только средство управления версиями, но и способ синхронизации заметок: перед тем, как выполнять какие-то работы на новом устройстве, запустить клиент гитхаба и проверить актуальность файлов (если файлы не самой свежей версии, появится кнопка Pull changes from repository)
- синхронизировать файлы между устройствами через что-то еще, например через Dropbox: тогда при нормальной работе средства синхронизации на всех устройствах будет актуальная версия файлов (а если возникли конфликты - возможно, что-то пошло не так и это - повод задуматься, что именно)

Я синхронизирую папки устройств через Dropbox и чувствую себя прекрасно. Клиент гитхаба у меня при этом почти всегда запущен на домашней машине (и с нее я отправляю изменения в репозиторий иногда даже чаще раза в день), редко запущен на маке и почти никогда не запущен на рабочем ноуте.

При необходимости синхронизировать репозиторий с облачной папкой на новом устройстве не обязательно проводить процедуру клонирования так, как было описано выше - можно выбрать опцию "add existing repository" и просто указать путь до нужной папки. Клиент гитхаба сам поймет, с каким репозиторием она синхронизирована, по системным файлам в папке .git.

> Не знаю, в чем здесь проблема, но когда добавляю созданный с вин машины репозиторий таким способом на маке - он на уровне гитхаб клиента дублирует некоторые файлы: до отправки push в папке все норм, но гитхаб подсвечивает какие-то фантомные добавления в клиенте, а после отправки push - создает такие файлы. При этом на вин машине эти файлы предложит удалить.
>
> Если же добавить реп в другую папку, или удалить все файлы из текущей папки + провести синхронизацию с репозиторием + положить файлы обратно - все будет нормально. Магия какая-то

---

Если хочется более сложный (но для кого-то более труъ) способ - можно организовать работу не через клиент GitHub Desktop, а через утилиту Git через консоль. Не представляю, как там работает отсмотр и управление изменениями, но первичную настройку Bryan Jenks в статье [How I Put My Mind Under Version Control](https://publish.obsidian.md/ryjjin/_Sources/How+I+Put+My+Mind+Under+Version+Control) описывал через нее.

Дальше - 5 основных моментов, на которые я обратил внимание в ходе тестов работы с GitHub. Последние два уже больше про то, как не потерять мощь гита как механизма управления версиями, нацелившись на удобство синхронизации изменений с репозиторием, но я решил пока что не делать какую-либо автоматизацию в этой части (потому что [Синхронизация с GitHub репозиторием помогает выявить непреднамеренные изменения](https://publish.obsidian.md/ryjjin/%D0%A1%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F+%D1%81+GitHub+%D1%80%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B5%D0%BC+%D0%BF%D0%BE%D0%BC%D0%BE%D0%B3%D0%B0%D0%B5%D1%82+%D0%B2%D1%8B%D1%8F%D0%B2%D0%B8%D1%82%D1%8C+%D0%BD%D0%B5%D0%BF%D1%80%D0%B5%D0%B4%D0%BD%D0%B0%D0%BC%D0%B5%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5+%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F)).

## 5 мыслей насчет использования GitHub при работе с заметками

### 1. Файл .gitignore в корне хранилища упрощает работу по контролю за изменениями

Чем меньше файлов будет изменяться - тем удобнее смотреть за изменениями и тем проще найти нужную операцию после.

Файл `.gitignore` говорит системе, на что не нужно обращать внимание при синхронизации. Я добавил в него папки, в которых при работе с кодом создаются временные файлы, системную папку Obsidian, а также папку Sources и мультимедийные файлы.

Сейчас он выглядит так (и в ближайшие полгода-год вряд ли изменится):

```text
.obsidian/
_Sources/
*.pdf
*.epub
*.azw3
*.djvu
*.doc
*.docx
*.xls
*.xlsx
*.pptx
*.rtf
*.rar
*.mp4
__pycache__/
.ipynb_checkpoints/
GitHub Projects/risks_and_tips-releases/
GitHub Projects/Obsidian-Dark-Graphite-Pie-theme/
GitHub Projects/Obsidian-shortcuts-extender/
```

> Последние три строки добавлены из-за того, что внутри моего хранилища Obsidian есть еще три гитхаб репозитория - это мои отдельные проекты, по которым я на гитхаб выкладываю код.

Но если в клиенте появилось много записей об изменениях, хотя по тексту вроде особых правок не было - стоит чекнуть, что там происходит и имеет ли смысл это тоже добавить в игнор.

### 2. Умеренно частый контроль изменений упрощает весь процесс

Чем чаще проходит контроль изменений - тем проще его делать. Когда только внес изменения, даже читать особо не приходится - можо просто оценивать символы на вес.

Каждый раз запускать клиент гитхаба может быть не очень увлекательно, но если запустить его вместе со стартом Obsidian и закинуть на соседний виртуальный рабочий стол - то отправлять изменения в репозиторий можно хоть при каждом выходе из-за стола (тут уже вопрос, будет ли в этом смысл).

На моей основной рабочей машине GitHub Desktop запущен у меня почти постоянно, так что в дни, когда я работаю за ней, я синхронизирую каталог на компе с приватным репозиторием ежедневно (и в то же время на ноутбуке в офисе у меня этот клиент обычно не запущен, и синхронизацию сделанных на нем изменений я выподняю уже из дома на следующий день).

### 3. Не нужно запариваться над автоматизацией процесса, если гит используется только для управления версиями файлов (не для сиюминутной синхронизации информации на устройствах)

Работа с GitHub Desktop уже в достаточной степени автоматизирована - нам не нужно каждый раз выбирать папку хранилища / делать что-то руками, если мы выбрали опцию "откатить изменения" или каждый раз заново подключаться к серверу.

Но в какой-то момент наверняка возникнет желание оставить на анализ только те изменения, которых не хотелось бы допускать, и сократить немного рутинных операций:

- проверку изменений в новых файлах
- проверку изменений в файлах, которые просто перенесены из одной папки в другую (тут я кстати не очень понимаю момент - веб-версия гитхаба в логах изменений для таких файлов показывает, что файл был просто перемещен, в то время как десктоп клиент почему-то показывает это как полное удаление и создание нового файла. Технически оно, конечно, верно, но почему они делают это по-разному?)
- проверку изменений в файлах, которые были просто открыты, но не были изменены (их клиент тоже подсвечивает)
- описание выполненных изменений (когда речь идет о заметках, а не о коде, часто вместо настоящего описания в поле просто вписывается дата или временная метка)

Не то чтобы это было необходимостью - скорее, это просто сделает процесс более приятным.

Скорее всего, это можно сделать на уровне простеньких скриптов или даже плагина для обсидиан, но потенциально настройка всего этого выльется в большую энергозатратносмть, чем просто каждый день проверять все самостоятельно.

"Скорее всего" в том смысле, что как минимум полную принудительную синхронизацию с проставлением таймштампа уже сделали - про это в пункте дальше. И, честно говоря, я не в курсе - может быть, это вообще штатный функционал на уровне клиента или репозитория, а я просто всех возможностей еще не знаю.

### 4. Возможно, имеет смысл задуматься над автоматизацией, если гит используется еще и для синхронизации

Если при помощи гита планируется поддерживать в репозитории самую актуальную версию файлов, то возможно имеет смысл сделать принудительную синхронизацию изменений с облаком:

- в статье [How I Put My Mind Under Version Control](https://publish.obsidian.md/ryjjin/_Sources/How+I+Put+My+Mind+Under+Version+Control) Bryan Jenks описывает, как он организовал синхронизацию между iCloud и GitHub по расписанию при помощи скриптов и cron.
- в обсидиане есть плагин Obsidian Git, делающий то же самое (его автор, Денис Олехов, вдохновлялся как раз этой статьей от Bryan Jenks). Правда, у меня на одном компе не получилось этот плагин запустить вообще, а на втором получилось, но отправку изменений на сервер все равно приходится делать из гитхаб клиента.

Тут можно сделать компромиссный вариант между принудительной отправкой всего на сервер и ручным контролем изменений - настроить автоматическую отправку на глубокую ночь, а руками стараться проверять изменения по окончанию работы с обсидианом: тогда в больгинстве случаев ошибки до сервера не дойдут, а если в какой-то день до ручного контроля и отправки не дошло - ночью все будет отправлено на сервер и на следующий день все устройства смогут пользоваться актуальной версией репозитория. И если для автоматизарованных и ручных отправок по-разному заполнять описания изменений, то в случае чего потом будет проще разбираться, где что.

### 5. Недостаток контроля за принудительной синхронизацией по расписанию можно чуть-чуть компенсировать

Если решено делать синхронизацию по расписанию - то возможно имеет смысл не складывать заметки в обсидиане в корневую папку.

Работать все будет и так и так, просто в гитхабе для вложенных в корень папок можно смотреть отфильтрованную по этой папке историю изменений.

> Насколько я понимаю, это работает всегда по области "вложенные в папку файлы + все дочерние папки", поэтому если хочется видеть отдельную историю изменений для тех заметок, что обычно лежат в корне - класть их нужно в /Notes
